# 已知问题和待办事项

## 🔴 高优先级问题

### 1. Clerk OAuth 功能测试
**状态**: 待测试  
**描述**: 虽然前端集成完成，但需要验证完整的 OAuth 流程  
**影响**: 用户可能无法通过社交登录成功登录  
**任务**:
- [ ] 测试 Google OAuth 完整流程
- [ ] 验证授权码交换和 token 获取
- [ ] 确认用户数据正确同步到后端
- [ ] 测试会话创建和持久化

### 2. 后端 Clerk 服务集成验证
**状态**: 需验证  
**描述**: `src/services/clerkService.js` 和相关端点需要测试  
**影响**: 前端 OAuth 成功后可能无法在后端正确处理  
**任务**:
- [ ] 测试 `/webapi/users/clerk/sync` 端点
- [ ] 验证用户数据格式和存储
- [ ] 确认 JWT token 生成和验证
- [ ] 测试数据库用户记录创建

### 3. 环境变量和配置验证
**状态**: 部分完成  
**描述**: Clerk 配置可能需要调整以适配生产环境  
**影响**: 生产部署时可能出现配置错误  
**任务**:
- [ ] 验证 `VITE_CLERK_PUBLISHABLE_KEY` 在所有环境正确
- [ ] 确认 OAuth 重定向 URL 配置
- [ ] 检查 CORS 设置对 Clerk 的兼容性
- [ ] 验证 Docker 环境变量传递

## 🟡 中等优先级问题

### 4. 错误处理和用户体验
**状态**: 基础完成  
**描述**: 需要增强错误场景的处理和用户反馈  
**任务**:
- [ ] 添加网络错误重试机制
- [ ] 改进 OAuth 失败时的用户指引
- [ ] 添加加载状态的骨架屏
- [ ] 优化移动端 OAuth 体验

### 5. 代码质量优化
**状态**: 待优化  
**描述**: 当前有大量 console.log 警告需要处理  
**影响**: 生产环境日志污染  
**任务**:
- [ ] 移除或条件化所有调试 console.log
- [ ] 添加生产环境日志级别控制
- [ ] 完善 TypeScript 类型定义
- [ ] 添加单元测试覆盖

### 6. 安全性检查
**状态**: 待评估  
**描述**: OAuth 集成的安全性需要全面审查  
**任务**:
- [ ] 审查 PKCE 实现的安全性
- [ ] 验证 state 参数防 CSRF
- [ ] 检查 token 存储和传输安全
- [ ] 确认用户数据脱敏处理

## 🟢 低优先级改进

### 7. 性能优化
**状态**: 可选  
**描述**: 进一步优化加载性能和用户体验  
**任务**:
- [ ] 实现 Clerk SDK 的按需加载
- [ ] 优化首屏渲染时间
- [ ] 添加离线状态处理
- [ ] 实现预加载优化

### 8. 国际化支持
**状态**: 未开始  
**描述**: 为 OAuth 流程添加多语言支持  
**任务**:
- [ ] 添加英文版社交登录页面
- [ ] 实现 Clerk 错误消息本地化
- [ ] 支持多语言用户界面切换

### 9. 监控和分析
**状态**: 未开始  
**描述**: 添加 OAuth 流程的监控和分析  
**任务**:
- [ ] 添加 OAuth 成功率统计
- [ ] 实现用户登录行为分析
- [ ] 添加错误率监控和报警

## 🔧 技术债务

### 10. 组件重构机会
- 社交登录组件可以提取为可复用组件
- Clerk store 可以进一步模块化
- OAuth 错误处理逻辑可以统一化

### 11. 文档完善
- [ ] 添加 Clerk 集成的开发者文档
- [ ] 创建 OAuth 流程的故障排除指南
- [ ] 更新部署文档包含 Clerk 配置

### 12. 测试覆盖
- [ ] 添加 Clerk store 的单元测试
- [ ] 创建 OAuth 流程的集成测试
- [ ] 添加错误场景的端到端测试

## 📝 注意事项

### 兼容性考虑
- 确保 Clerk 版本与 Vue 3 兼容
- 检查在不同浏览器中的 OAuth 行为
- 验证移动设备上的用户体验

### 部署要求
- 生产环境需要 HTTPS（OAuth 必需）
- 确保 Clerk Dashboard 中的域名配置正确
- 验证反向代理对 OAuth 重定向的处理

### 维护计划
- 定期更新 Clerk SDK 版本
- 监控 OAuth 提供商的变更
- 保持与上游 Clerk 文档的同步

---

**最后更新**: 2025-09-08  
**负责人**: Claude Code  
**审查状态**: 待团队确认